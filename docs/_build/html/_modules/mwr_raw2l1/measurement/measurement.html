<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>mwr_raw2l1.measurement.measurement &mdash; mwr_raw2l1  documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> mwr_raw2l1
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">mwr_raw2l1</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>mwr_raw2l1.measurement.measurement</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for mwr_raw2l1.measurement.measurement</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">mwr_raw2l1.errors</span> <span class="kn">import</span> <span class="n">CoordinateError</span><span class="p">,</span> <span class="n">MissingDataSource</span>
<span class="kn">from</span> <span class="nn">mwr_raw2l1.log</span> <span class="kn">import</span> <span class="n">logger</span>
<span class="kn">from</span> <span class="nn">mwr_raw2l1.measurement.rpg_helpers</span> <span class="kn">import</span> <span class="n">merge_brt_blb</span><span class="p">,</span> <span class="n">to_datasets</span>


<div class="viewcode-block" id="Measurement"><a class="viewcode-back" href="../../../api/measurement.html#mwr_raw2l1.measurement.measurement.Measurement">[docs]</a><span class="k">class</span> <span class="nc">Measurement</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>

<div class="viewcode-block" id="Measurement.run"><a class="viewcode-back" href="../../../api/measurement.html#mwr_raw2l1.measurement.measurement.Measurement.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf_inst</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_coord</span><span class="p">(</span><span class="n">conf_inst</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_statusflag</span><span class="p">()</span></div>

<div class="viewcode-block" id="Measurement.from_rpg"><a class="viewcode-back" href="../../../api/measurement.html#mwr_raw2l1.measurement.measurement.Measurement.from_rpg">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_rpg</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">readin_data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;constructor for data read in from RPG instruments.</span>

<span class="sd">        Auxiliary data are merged to time grid of MWR data. Scanning MWR data are returned as time series (no ele dim)</span>

<span class="sd">        Args:</span>
<span class="sd">            readin_data: dictionary with list of instances for each RPG read-in class (keys correspond to filetype)</span>
<span class="sd">        Returns:</span>
<span class="sd">            an instance of the Measurement class with observations filled to self.data</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># dimensions and variable names for usage with make_dataset</span>
        <span class="n">dims</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;brt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency&#39;</span><span class="p">],</span>
                <span class="s1">&#39;blb&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_ele&#39;</span><span class="p">],</span>
                <span class="s1">&#39;irt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="s1">&#39;ir_wavelength&#39;</span><span class="p">],</span>
                <span class="s1">&#39;met&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span>
                <span class="s1">&#39;hkd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]}</span>
        <span class="nb">vars</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;brt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">,</span> <span class="s1">&#39;rainflag&#39;</span><span class="p">,</span> <span class="s1">&#39;ele&#39;</span><span class="p">,</span> <span class="s1">&#39;azi&#39;</span><span class="p">],</span>
                <span class="s1">&#39;blb&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Tb&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;rainflag&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_quadrant&#39;</span><span class="p">],</span>  <span class="c1"># TODO: find a way to infer &#39;azi&#39; from blb</span>
                <span class="s1">&#39;irt&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;IRT&#39;</span><span class="p">,</span> <span class="s1">&#39;rainflag&#39;</span><span class="p">,</span> <span class="s1">&#39;ele&#39;</span><span class="p">,</span> <span class="s1">&#39;azi&#39;</span><span class="p">],</span>
                <span class="s1">&#39;met&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;RH&#39;</span><span class="p">],</span>
                <span class="s1">&#39;hkd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;alarm&#39;</span><span class="p">]}</span>
        <span class="n">vars_opt</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;brt&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;blb&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;irt&#39;</span><span class="p">:</span> <span class="p">[],</span>
                    <span class="s1">&#39;met&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;windspeed&#39;</span><span class="p">,</span> <span class="s1">&#39;winddir&#39;</span><span class="p">,</span> <span class="s1">&#39;rainrate&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;hkd&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">,</span> <span class="s1">&#39;T_amb_1&#39;</span><span class="p">,</span> <span class="s1">&#39;T_amb_2&#39;</span><span class="p">,</span> <span class="s1">&#39;T_receiver_kband&#39;</span><span class="p">,</span> <span class="s1">&#39;T_receiver_vband&#39;</span><span class="p">,</span>
                            <span class="s1">&#39;Tstab_kband&#39;</span><span class="p">,</span> <span class="s1">&#39;Tstab_vband&#39;</span><span class="p">,</span> <span class="s1">&#39;flashmemory_remaining&#39;</span><span class="p">,</span> <span class="s1">&#39;BLscan_active&#39;</span><span class="p">]}</span>
        <span class="c1"># TODO : check what other hkd variables are needed for output statusflag and monitoring!!!</span>
        <span class="n">scanflag_values</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;brt&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;blb&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>  <span class="c1"># for generating a scan flag indicating whether scanning or zenith obs</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Creating instance of Measurement class&#39;</span><span class="p">)</span>

        <span class="c1"># require mandatory data sources</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;brt&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">readin_data</span> <span class="ow">and</span> <span class="s1">&#39;blb&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">readin_data</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span>
                <span class="ow">not</span> <span class="n">readin_data</span><span class="p">[</span><span class="s1">&#39;brt&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">readin_data</span><span class="p">[</span><span class="s1">&#39;blb&#39;</span><span class="p">]):</span>
            <span class="k">raise</span> <span class="n">MissingDataSource</span><span class="p">(</span><span class="s1">&#39;At least one file of brt (zenith MWR) or blb (scanning MWR) must be present&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;hkd&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">readin_data</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">readin_data</span><span class="p">[</span><span class="s1">&#39;hkd&#39;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">MissingDataSource</span><span class="p">(</span><span class="s1">&#39;The housekeeping file (hkd) must be present&#39;</span><span class="p">)</span>

        <span class="c1"># construct datasets</span>
        <span class="n">all_data</span> <span class="o">=</span> <span class="n">to_datasets</span><span class="p">(</span><span class="n">readin_data</span><span class="p">,</span> <span class="n">dims</span><span class="p">,</span> <span class="nb">vars</span><span class="p">,</span> <span class="n">vars_opt</span><span class="p">)</span>

        <span class="c1"># infer MWR data sources (BRT and/or BLB) and add scanflag</span>
        <span class="n">mwr_sources_present</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">src</span><span class="p">,</span> <span class="n">flagval</span> <span class="ow">in</span> <span class="n">scanflag_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">all_data</span> <span class="ow">and</span> <span class="n">all_data</span><span class="p">[</span><span class="n">src</span><span class="p">]:</span>  <span class="c1"># check corresponding data series is not an empty list</span>
                <span class="n">mwr_sources_present</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src</span><span class="p">)</span>
                <span class="n">all_data</span><span class="p">[</span><span class="n">src</span><span class="p">][</span><span class="s1">&#39;scaflag&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">flagval</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">all_data</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">time</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;u1&#39;</span><span class="p">))</span>
        <span class="n">mwr_data</span> <span class="o">=</span> <span class="n">merge_brt_blb</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>

        <span class="c1"># init measurement class and merge BRT and BLB data to time series of brightness temperatures</span>
        <span class="n">out</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">()</span>
        <span class="n">out</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">mwr_data</span>

        <span class="c1"># bring other data to time grid of brightness temperatures</span>
        <span class="k">for</span> <span class="n">src</span> <span class="ow">in</span> <span class="n">readin_data</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">src</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;brt&#39;</span><span class="p">,</span> <span class="s1">&#39;blb&#39;</span><span class="p">]:</span>  <span class="c1"># BRT and BLB data already treated</span>
                <span class="k">continue</span>

            <span class="c1"># to make sure no variable is overwritten rename duplicates by suffixing it with its source</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">all_data</span><span class="p">[</span><span class="n">src</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                    <span class="n">varname_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="p">:</span> <span class="n">var</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">src</span><span class="p">}</span>
                    <span class="n">all_data</span><span class="p">[</span><span class="n">src</span><span class="p">]</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">varname_map</span><span class="p">)</span>

            <span class="c1"># interp to same time grid (time grid from blb now stems from some interp) and merge into out.data</span>
            <span class="n">srcdat_interp</span> <span class="o">=</span> <span class="n">all_data</span><span class="p">[</span><span class="n">src</span><span class="p">]</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">],</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)</span>  <span class="c1"># nearest: flags stay integer</span>
            <span class="n">out</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">out</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">srcdat_interp</span><span class="p">,</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>

<div class="viewcode-block" id="Measurement.from_radiometrics"><a class="viewcode-back" href="../../../api/measurement.html#mwr_raw2l1.measurement.measurement.Measurement.from_radiometrics">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_radiometrics</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">readin_data</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Measurement.from_attex"><a class="viewcode-back" href="../../../api/measurement.html#mwr_raw2l1.measurement.measurement.Measurement.from_attex">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_attex</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">read_in_data</span><span class="p">):</span>
        <span class="k">pass</span></div>

<div class="viewcode-block" id="Measurement.set_coord"><a class="viewcode-back" href="../../../api/measurement.html#mwr_raw2l1.measurement.measurement.Measurement.set_coord">[docs]</a>    <span class="k">def</span> <span class="nf">set_coord</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">conf_inst</span><span class="p">,</span> <span class="n">primary_src</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">delta_lat</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">delta_lon</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span> <span class="n">delta_altitude</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;(re)set coordinate variables (lat, lon, altitude) in self.data from datafile input and configuration</span>

<span class="sd">        If both are available the method checks consistency between coordinates in datafile and configuration.</span>

<span class="sd">        Args:</span>
<span class="sd">            conf_inst: configuration dictionary for instrument containing keys station_latitude, station_longitude and</span>
<span class="sd">                station_altitude. If set to None, coordinates are taken from datafile without any checks and an error is</span>
<span class="sd">                raised if any of lat, lon or altitude is missing in data.</span>
<span class="sd">            primary_src (optional {&#39;data&#39;, &#39;config&#39;}): specifies which source takes precedence. Defaults to &#39;data&#39;</span>
<span class="sd">            delta_lat (optional): maximum allowed difference between latitude in config and in datafile in degrees.</span>
<span class="sd">                Defaults to 0.01.</span>
<span class="sd">            delta_lon (optional): maximum allowed difference between longitude in config and in datafile in degrees.</span>
<span class="sd">                Defaults to 0.02.</span>
<span class="sd">            delta_altitude (optional): maximum allowed difference between altitude in config and in datafile in meters.</span>
<span class="sd">                Defaults to 10.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># matching of variable names between self.data and conf and between data variables and accuracy limits</span>
        <span class="n">var_data_conf</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="s1">&#39;station_latitude&#39;</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="s1">&#39;station_longitude&#39;</span><span class="p">,</span> <span class="s1">&#39;altitude&#39;</span><span class="p">:</span> <span class="s1">&#39;station_altitude&#39;</span><span class="p">}</span>
        <span class="n">acc_matching</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;lat&#39;</span><span class="p">:</span> <span class="n">delta_lat</span><span class="p">,</span> <span class="s1">&#39;lon&#39;</span><span class="p">:</span> <span class="n">delta_lon</span><span class="p">,</span> <span class="s1">&#39;altitude&#39;</span><span class="p">:</span> <span class="n">delta_altitude</span><span class="p">}</span>

        <span class="c1"># strategy: do nothing if using variable from data, reset if using variable from config</span>
        <span class="k">if</span> <span class="n">conf_inst</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>  <span class="c1"># no config input</span>
            <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_data_conf</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">raise</span> <span class="n">CoordinateError</span><span class="p">(</span><span class="s2">&quot;Cannot set coordinates. &#39;conf_inst&#39; was set to None, but &#39;</span><span class="si">{}</span><span class="s2">&#39; is missing &quot;</span>
                                          <span class="s1">&#39;in read in data&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">))</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">var</span> <span class="ow">in</span> <span class="n">conf_inst</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="n">var_data_conf</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span>  <span class="c1"># missing keys in config</span>
            <span class="n">err_msg</span> <span class="o">=</span> <span class="s2">&quot;&#39;conf_inst&#39; needs to contain all of the following keys: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">var_data_conf</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
            <span class="k">raise</span> <span class="n">CoordinateError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># necessary values present in config</span>
            <span class="k">for</span> <span class="n">var</span><span class="p">,</span> <span class="n">acc</span> <span class="ow">in</span> <span class="n">acc_matching</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">conf_inst</span><span class="p">[</span><span class="n">var_data_conf</span><span class="p">[</span><span class="n">var</span><span class="p">]])</span> <span class="o">&gt;</span> <span class="n">acc</span><span class="p">:</span>  <span class="c1"># checking all elements too slow</span>
                        <span class="k">raise</span> <span class="n">CoordinateError</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">{}</span><span class="s2">&#39; in data and conf differs by more than </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">acc</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">primary_src</span> <span class="o">==</span> <span class="s1">&#39;config&#39;</span> <span class="ow">or</span> <span class="n">var</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>  <span class="c1"># (re)set variable according to conf_inst</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="n">var</span><span class="p">]</span> <span class="o">=</span> <span class="p">((</span><span class="s1">&#39;time&#39;</span><span class="p">,),</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">time</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">conf_inst</span><span class="p">[</span><span class="n">var_data_conf</span><span class="p">[</span><span class="n">var</span><span class="p">]]))</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using &#39;</span><span class="si">{}</span><span class="s2">&#39; from config as coordinate variable&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var_data_conf</span><span class="p">[</span><span class="n">var</span><span class="p">]))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using &#39;</span><span class="si">{}</span><span class="s2">&#39; from data files as coordinate variable&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">var</span><span class="p">))</span></div>

<div class="viewcode-block" id="Measurement.set_statusflag"><a class="viewcode-back" href="../../../api/measurement.html#mwr_raw2l1.measurement.measurement.Measurement.set_statusflag">[docs]</a>    <span class="k">def</span> <span class="nf">set_statusflag</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;set statusflag from data&quot;&quot;&quot;</span>
        <span class="k">pass</span>  <span class="c1"># TODO: Implement method for setting statusflag from data (and possibly conf_inst)</span></div></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mwr_raw2l1.readers.reader_rpg</span> <span class="kn">import</span> <span class="n">read_multiple_files</span>
    <span class="kn">from</span> <span class="nn">mwr_raw2l1.utils.file_utils</span> <span class="kn">import</span> <span class="n">abs_file_path</span><span class="p">,</span> <span class="n">get_files</span>

    <span class="n">files</span> <span class="o">=</span> <span class="n">get_files</span><span class="p">(</span><span class="n">abs_file_path</span><span class="p">(</span><span class="s1">&#39;mwr_raw2l1/data/rpg/0-20000-0-06610/&#39;</span><span class="p">),</span> <span class="s1">&#39;MWR_0-20000-0-06610_A&#39;</span><span class="p">)</span>
    <span class="n">all_data</span> <span class="o">=</span> <span class="n">read_multiple_files</span><span class="p">(</span><span class="n">files</span><span class="p">)</span>
    <span class="n">meas</span> <span class="o">=</span> <span class="n">Measurement</span><span class="o">.</span><span class="n">from_rpg</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>
    <span class="n">meas</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Rolf RÃ¼fenacht.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
         .wy-nav-content { max-width: none; }
  </style>



</body>
</html>